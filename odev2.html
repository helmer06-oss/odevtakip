<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tolgaaydos.com â€“ Ã–dev Takip Sistemi</title>
  <style>
    :root{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      --bg:#f1f3f6; --card:#fff; --text:#1f2937; --muted:#6b7280;
      --line:#e5e7eb; --blue:#0b79f7; --green:#22c55e; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);}
    .wrap{max-width:600px;margin:0 auto;padding:22px 14px 34px;}
    .card{background:var(--card);border-radius:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:18px;overflow:hidden;}
    .brandBand{
      display:flex;align-items:center;justify-content:center;gap:16px;
      padding:14px;margin:-18px -18px 16px;background:linear-gradient(180deg,#fff,#f7f8fb);
      border-bottom:1px solid var(--line);
    }
    .brandBand img{width:56px;height:56px;object-fit:contain;border-radius:12px;flex:0 0 auto;}
    .brandText{display:flex;flex-direction:column;line-height:1.1;text-align:left}
    .brandTop{font-weight:900;font-size:24px;letter-spacing:.4px}
    .brandBottom{font-weight:800;font-size:20px;letter-spacing:.25px;color:#374151}
    @media(max-width:420px){.brandBand img{width:48px;height:48px}.brandTop{font-size:21px}.brandBottom{font-size:18px}}

    label{display:block;font-weight:850;color:#374151;margin:14px 0 8px;font-size:16px;}
    input,select{width:100%;padding:14px;border-radius:12px;border:2px solid var(--line);background:#fff;font-size:16px;outline:none;display:block;}
    input:focus,select:focus{border-color:#bcd7ff; box-shadow:0 0 0 4px rgba(11,121,247,.10);}
    .row{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:14px;}
    @media(max-width:420px){.row{grid-template-columns:1fr}}
    .btn{width:100%;padding:14px 16px;border:none;border-radius:12px;font-size:18px;font-weight:900;color:#fff;cursor:pointer;}
    .btn.blue{background:var(--blue);margin-top:16px;}
    .btn.green{background:var(--green);display:flex;align-items:center;justify-content:center;gap:10px;}
    .sep{height:2px;background:var(--line);margin:16px 0;}
    .tinyRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;}
    @media(max-width:420px){.tinyRow{grid-template-columns:1fr}}
    .ghost{background:#eef1f7;color:#111;border:1px solid #d6d8e1;}
    details{margin-top:14px}
    summary{cursor:pointer;color:var(--muted);font-weight:850}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{padding:10px 6px;border-bottom:1px solid var(--line);text-align:left;font-size:14px;vertical-align:top;word-break:break-word;}
    th{color:var(--muted);font-weight:900;font-size:12px}
    .tag{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;color:#1d4ed8;font-weight:900;font-size:12px}
    .danger{border:none;background:var(--danger);color:#fff;border-radius:10px;padding:8px 10px;font-weight:900;cursor:pointer;white-space:nowrap;}
    .status{margin-top:10px;font-size:13px;color:var(--muted);text-align:center}
  </style>
</head>
<body>
  
  <!--
  Proje: tolgaaydos.com - Ã–dev Takip Sistemi
  SÃ¼rÃ¼m: v1.2
  GÃ¼ncelleme: WhatsApp mesaj baÅŸlÄ±klarÄ± sadeleÅŸtirildi
  Tarih: 25.12.2025
-->
  
  <div class="wrap">
    <div class="card">

      <div class="brandBand">
        <div style="
  font-size:12px;
  color:#6b7280;
  text-align:center;
  margin-top:-8px;
  margin-bottom:8px;
">
  v1.2 Â· WhatsApp mesaj dÃ¼zeni gÃ¼ncellendi
</div>

        <img id="brandLogo" src="logo.png" alt="Tolga Aydos Logo">
        <div class="brandText">
          <div class="brandTop">tolgaaydos.com</div>
          <div class="brandBottom">Ã–dev Takip Sistemi</div>
        </div>
      </div>

      <label>Ã–ÄŸrenci AdÄ± SoyadÄ±:</label>
      <input id="student" list="studentList" placeholder="Ã–rn: Ahmet YÄ±lmaz" autocomplete="off" />
      <datalist id="studentList"></datalist>

      <label>Tarih:</label>
      <input id="date" type="date" />

      <label>Kitap SeÃ§imi:</label>
      <select id="book">
        <option value="">Kitap SeÃ§iniz...</option>
        <option>TYT Matematik Soru BankasÄ±</option>
        <option>AYT Fizik Konu AnlatÄ±mÄ±</option>
        <option>Geometri Yaprak Test</option>
        <option>Paragraf Soru BankasÄ±</option>
        <option>Kimya Denemeleri</option>
      </select>

      <div class="row">
        <div>
          <label>BaÅŸlangÄ±Ã§ SayfasÄ±:</label>
          <input id="pStart" type="number" min="1" placeholder="10" />
        </div>
        <div>
          <label>BitiÅŸ SayfasÄ±:</label>
          <input id="pEnd" type="number" min="1" placeholder="15" />
        </div>
      </div>

      <button class="btn blue" id="addBtn" type="button">Listeye Ekle</button>

      <div class="sep"></div>

      <button class="btn green" id="waBtn" type="button"><span>ðŸ“²</span> WhatsApp ile GÃ¶nder</button>

      <div class="tinyRow">
        <button class="btn ghost" id="copyBtn" type="button">Metni Kopyala</button>
        <button class="btn ghost" id="todayBtn" type="button">BugÃ¼n</button>
      </div>

      <div class="status" id="status">HazÄ±r.</div>

      <details>
        <summary>KayÄ±tlarÄ± GÃ¶ster / YÃ¶net</summary>
        <table>
          <thead>
            <tr>
              <th>Ã–ÄŸrenci</th><th>Tarih</th><th>Kitap</th><th>Sayfa</th><th></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div style="margin-top:12px;">
          <button class="danger" id="wipeBtn" type="button">TÃ¼m Veriyi Sil</button>
        </div>
      </details>

    </div>
  </div>

<script>
  const KEY = "odev_panel_students_mobilefix_v1";
  const $ = (id) => document.getElementById(id);

  function setStatus(msg){ $("status").textContent = msg; }

  // logo fallback
  (function fixLogo(){
    const img = $("brandLogo");
    img.addEventListener("error", () => {
      const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80">
        <rect width="100%" height="100%" rx="14" fill="#eef2ff"/>
        <text x="50%" y="54%" text-anchor="middle" font-size="34" font-family="Arial" fill="#1d4ed8" font-weight="700">TA</text>
      </svg>`;
      img.src = "data:image/svg+xml;utf8," + encodeURIComponent(svg);
    });
  })();

  function todayISO(){
    const d = new Date();
    d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
    return d.toISOString().slice(0,10);
  }

  // âœ… iOS/Preview sorunlarÄ±na karÅŸÄ±: localStorage Ã§alÄ±ÅŸmazsa sessionStorageâ€™a dÃ¼ÅŸ
  function storageOK(){
    try{
      localStorage.setItem("__t","1");
      localStorage.removeItem("__t");
      return true;
    }catch{
      return false;
    }
  }
  const STORE = storageOK() ? localStorage : sessionStorage;

  function load(){
    try{ return JSON.parse(STORE.getItem(KEY) || '{"students":{}}'); }
    catch{ return { students:{} }; }
  }
  function save(db){ STORE.setItem(KEY, JSON.stringify(db)); }

  function normName(s){ return (s||"").trim().replace(/\s+/g," "); }
  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function ensureStudent(db, studentName){
    if(!db.students[studentName]){
      db.students[studentName] = { createdAt: Date.now(), assignments: [] };
    }
  }

  function validate(student, date, book, pStart, pEnd){
    if(!student) return "Ã–ÄŸrenci adÄ± soyadÄ± boÅŸ olamaz.";
    if(!date) return "Tarih seÃ§melisin.";
    if(!book) return "LÃ¼tfen bir kitap seÃ§iniz.";
    if(pStart && pEnd && Number(pEnd) < Number(pStart)) return "BitiÅŸ sayfasÄ±, baÅŸlangÄ±Ã§tan kÃ¼Ã§Ã¼k olamaz.";
    return "";
  }

  function refreshStudentDatalist(db){
    const dl = $("studentList");
    const names = Object.keys(db.students).sort((a,b)=>a.localeCompare(b,"tr"));
    dl.innerHTML = "";
    names.forEach(n=>{
      const o=document.createElement("option");
      o.value=n;
      dl.appendChild(o);
    });
  }

  function flatRows(db){
    const rows = [];
    for(const [student, rec] of Object.entries(db.students)){
      for(let i=0;i<rec.assignments.length;i++){
        rows.push({ student, idx:i, ...rec.assignments[i] });
      }
    }
    rows.sort((x,y)=>(y.createdAt||0)-(x.createdAt||0));
    return rows;
  }

  function render(){
    const db = load();
    refreshStudentDatalist(db);

    const rows = flatRows(db);
    const tb = $("tbody");
    tb.innerHTML = "";

    rows.forEach(r=>{
      const pages = `${r.pStart || ""}${r.pEnd ? "-" + r.pEnd : ""}`.trim() || "-";
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${esc(r.student)}</td>
        <td><span class="tag">${esc(r.date || "-")}</span></td>
        <td>${esc(r.book)}</td>
        <td>${esc(pages)}</td>
        <td><button class="danger" type="button" data-student="${esc(r.student)}" data-idx="${r.idx}">Sil</button></td>
      `;
      tb.appendChild(tr);
    });

    setStatus(`HazÄ±r. KayÄ±t sayÄ±sÄ±: ${rows.length} (${STORE === localStorage ? "kalÄ±cÄ±" : "geÃ§ici"})`);
  }

  function buildWhatsAppMessage(studentName, dateISO){
  const db = load();
  const rec = db.students[studentName];
  if(!rec) return "";

  const list = rec.assignments.filter(a => a.date === dateISO);
  if(list.length === 0) return "";

  const trDate = dateISO.split("-").reverse().join(".");

  const pageText = (a) => {
    const s = `${a.pStart || ""}${a.pEnd ? "-" + a.pEnd : ""}`.trim();
    return s || "-";
  };

  // AynÄ± kitaptan birden fazla varsa birleÅŸtir
  const grouped = {};
  list.forEach(a => {
    grouped[a.book] = grouped[a.book] || [];
    grouped[a.book].push(pageText(a));
  });

  const lines = [];

  // BaÅŸlÄ±k
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("*tolgaaydos.com*  |  *Ã–dev Takip Sistemi*");
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
  lines.push("");

  // âœ… 1) Tarih en Ã¼ste
  lines.push(`ðŸ“… *Tarih:* ${trDate}`);
  lines.push(`ðŸŽ“ *Ã–ÄŸrenci:* ${studentName}`);
  lines.push("");

  // âœ… 2) Ã–devler baÅŸlÄ±ÄŸÄ± daha gÃ¼Ã§lÃ¼
  lines.push("â•â•â•â•â•â•â•â•â•â•  ðŸ“š *Ã–DEVLER*  â•â•â•â•â•â•â•â•â•â•");

  let i = 1;
  Object.keys(grouped).forEach(book => {
    const pages = grouped[book].join(", ");
    lines.push(`${i}) *${book}*`);
    lines.push(`   â–¸ Sayfa: ${pages}`);
    i++;
  });

  lines.push("");
  lines.push("_Ä°yi Ã§alÄ±ÅŸmalar._");

  // âœ… 3) Otomatik imza
  lines.push("*Tolga Hoca*");
  lines.push("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

  return lines.join("\n");
}


  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      setStatus("Metin kopyalandÄ±.");
    }catch{
      const ta=document.createElement("textarea");
      ta.value=text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      setStatus("Metin kopyalandÄ±.");
    }
  }

  // init
  $("date").value = todayISO();
  render();

  $("todayBtn").addEventListener("click", () => {
    $("date").value = todayISO();
    setStatus("Tarih: BugÃ¼n seÃ§ildi.");
  });

  $("addBtn").addEventListener("click", () => {
    try{
      const student = normName($("student").value);
      const date = $("date").value;
      const book = $("book").value;
      const pStart = $("pStart").value ? Number($("pStart").value) : "";
      const pEnd = $("pEnd").value ? Number($("pEnd").value) : "";

      const err = validate(student, date, book, pStart, pEnd);
      if(err){ alert(err); setStatus(err); return; }

      const db = load();
      ensureStudent(db, student);

      db.students[student].assignments.push({ date, book, pStart, pEnd, createdAt: Date.now() });
      save(db);

      $("book").value=""; $("pStart").value=""; $("pEnd").value="";
      setStatus("KayÄ±t eklendi.");
      render();
    }catch(e){
      alert("KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu.");
      setStatus("Hata: " + (e && e.message ? e.message : e));
    }
  });

  $("waBtn").addEventListener("click", () => {
    try{
      const student = normName($("student").value);
      const date = $("date").value;

      if(!student){ alert("Ã–ÄŸrenci adÄ±nÄ± yazmalÄ±sÄ±n."); setStatus("Ã–ÄŸrenci adÄ± eksik."); return; }
      if(!date){ alert("Tarih seÃ§melisin."); setStatus("Tarih eksik."); return; }

      const text = buildWhatsAppMessage(student, date);
      if(!text){ alert("Bu Ã¶ÄŸrenci iÃ§in seÃ§ili tarihte Ã¶dev yok."); setStatus("GÃ¶nderilecek Ã¶dev yok."); return; }

      // âœ… iOSâ€™ta en stabil yÃ¶ntem: yeni pencere deÄŸil, aynÄ± sekmede yÃ¶nlendirme
      const url = "https://wa.me/?text=" + encodeURIComponent(text);
      setStatus("WhatsApp aÃ§Ä±lÄ±yor...");
      location.href = url;
    }catch(e){
      alert("WhatsApp aÃ§Ä±lÄ±rken hata oluÅŸtu.");
      setStatus("Hata: " + (e && e.message ? e.message : e));
    }
  });

  $("copyBtn").addEventListener("click", async () => {
    const student = normName($("student").value);
    const date = $("date").value;
    if(!student){ alert("Ã–ÄŸrenci adÄ±nÄ± yazmalÄ±sÄ±n."); setStatus("Ã–ÄŸrenci adÄ± eksik."); return; }
    if(!date){ alert("Tarih seÃ§melisin."); setStatus("Tarih eksik."); return; }
    const text = buildWhatsAppMessage(student, date);
    if(!text){ alert("Bu Ã¶ÄŸrenci iÃ§in seÃ§ili tarihte Ã¶dev yok."); setStatus("Kopyalanacak metin yok."); return; }
    await copyText(text);
  });

  $("tbody").addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-student]");
    if(!btn) return;

    const student = btn.getAttribute("data-student");
    const idx = Number(btn.getAttribute("data-idx"));

    const db = load();
    const rec = db.students[student];
    if(!rec) return;

    rec.assignments.splice(idx, 1);
    if(rec.assignments.length === 0) delete db.students[student];

    save(db);
    setStatus("KayÄ±t silindi.");
    render();
  });

  $("wipeBtn").addEventListener("click", () => {
    if(!confirm("TÃ¼m kayÄ±tlar silinsin mi?")) return;
    STORE.removeItem(KEY);
    setStatus("TÃ¼m veriler silindi.");
    render();
  });
</script>
</body>
</html>

